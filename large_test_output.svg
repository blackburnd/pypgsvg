<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg id="main-svg" width="1757pt" height="768pt"
 viewBox="0.00 0.00 1756.64 768.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="main-erd-group" class="graph" transform="scale(1 1) rotate(0) translate(4 764.25)" style="pointer-events: all;">
<polygon fill="white" stroke="none" points="-4,4 -4,-764.25 1752.64,-764.25 1752.64,4 -4,4"/>
<!-- users -->
<g id="users" class="node">
<title>users</title>
<polygon fill="white" stroke="black" points="261.89,-157.75 49.14,-157.75 49.14,0 261.89,0 261.89,-157.75"/>
<polygon fill="#93c4b8" stroke="none" points="57.14,-119 57.14,-153.75 253.89,-153.75 253.89,-119 57.14,-119"/>
<polygon fill="none" stroke="black" points="57.14,-119 57.14,-153.75 253.89,-153.75 253.89,-119 57.14,-119"/>
<text text-anchor="start" x="125.89" y="-125.95" font-family="Sans-Serif" font-size="24.00">users</text>
<polygon fill="none" stroke="black" points="57.14,-90.25 57.14,-119 253.89,-119 253.89,-90.25 57.14,-90.25"/>
<text text-anchor="start" x="62.14" y="-96.9" font-family="Sans-Serif" font-size="18.00">id (integer)</text>
<polygon fill="none" stroke="black" points="57.14,-61.5 57.14,-90.25 253.89,-90.25 253.89,-61.5 57.14,-61.5"/>
<text text-anchor="start" x="62.14" y="-68.15" font-family="Sans-Serif" font-size="18.00">username (varchar(50))</text>
<polygon fill="none" stroke="black" points="57.14,-32.75 57.14,-61.5 253.89,-61.5 253.89,-32.75 57.14,-32.75"/>
<text text-anchor="start" x="62.14" y="-39.4" font-family="Sans-Serif" font-size="18.00">email (varchar(100))</text>
<polygon fill="none" stroke="black" points="57.14,-4 57.14,-32.75 253.89,-32.75 253.89,-4 57.14,-4"/>
<text text-anchor="start" x="62.14" y="-10.65" font-family="Sans-Serif" font-size="18.00">created_at (timestamp)</text>
</g>
<!-- categories -->
<g id="categories" class="node">
<title>categories</title>
<polygon fill="white" stroke="black" points="1166.52,-143.38 978.52,-143.38 978.52,-14.38 1166.52,-14.38 1166.52,-143.38"/>
<polygon fill="#e8a8a8" stroke="none" points="986.52,-104.62 986.52,-139.38 1158.52,-139.38 1158.52,-104.62 986.52,-104.62"/>
<polygon fill="none" stroke="black" points="986.52,-104.62 986.52,-139.38 1158.52,-139.38 1158.52,-104.62 986.52,-104.62"/>
<text text-anchor="start" x="1016.64" y="-111.58" font-family="Sans-Serif" font-size="24.00">categories</text>
<polygon fill="none" stroke="black" points="986.52,-75.88 986.52,-104.62 1158.52,-104.62 1158.52,-75.88 986.52,-75.88"/>
<text text-anchor="start" x="991.52" y="-82.53" font-family="Sans-Serif" font-size="18.00">id (integer)</text>
<polygon fill="none" stroke="black" points="986.52,-47.12 986.52,-75.88 1158.52,-75.88 1158.52,-47.12 986.52,-47.12"/>
<text text-anchor="start" x="991.52" y="-53.77" font-family="Sans-Serif" font-size="18.00">name (varchar(100))</text>
<polygon fill="none" stroke="black" points="986.52,-18.38 986.52,-47.12 1158.52,-47.12 1158.52,-18.38 986.52,-18.38"/>
<text text-anchor="start" x="991.52" y="-25.02" font-family="Sans-Serif" font-size="18.00">description (text)</text>
</g>
<!-- posts -->
<g id="posts" class="node">
<title>posts</title>
<polygon fill="white" stroke="black" points="994.64,-487.75 780.39,-487.75 780.39,-243.75 994.64,-243.75 994.64,-487.75"/>
<polygon fill="#e8d8a8" stroke="none" points="788.39,-449 788.39,-483.75 986.64,-483.75 986.64,-449 788.39,-449"/>
<polygon fill="none" stroke="black" points="788.39,-449 788.39,-483.75 986.64,-483.75 986.64,-449 788.39,-449"/>
<text text-anchor="start" x="858.64" y="-455.95" font-family="Sans-Serif" font-size="24.00">posts</text>
<polygon fill="none" stroke="black" points="788.39,-420.25 788.39,-449 986.64,-449 986.64,-420.25 788.39,-420.25"/>
<text text-anchor="start" x="793.39" y="-426.9" font-family="Sans-Serif" font-size="18.00">id (integer)</text>
<polygon fill="none" stroke="black" points="788.39,-391.5 788.39,-420.25 986.64,-420.25 986.64,-391.5 788.39,-391.5"/>
<text text-anchor="start" x="793.39" y="-398.15" font-family="Sans-Serif" font-size="18.00">title (varchar(200))</text>
<polygon fill="none" stroke="black" points="788.39,-362.75 788.39,-391.5 986.64,-391.5 986.64,-362.75 788.39,-362.75"/>
<text text-anchor="start" x="793.39" y="-369.4" font-family="Sans-Serif" font-size="18.00">content (text)</text>
<polygon fill="none" stroke="black" points="788.39,-334 788.39,-362.75 986.64,-362.75 986.64,-334 788.39,-334"/>
<text text-anchor="start" x="793.39" y="-340.65" font-family="Sans-Serif" font-size="18.00">user_id (integer)</text>
<polygon fill="none" stroke="black" points="788.39,-305.25 788.39,-334 986.64,-334 986.64,-305.25 788.39,-305.25"/>
<text text-anchor="start" x="793.39" y="-311.9" font-family="Sans-Serif" font-size="18.00">category_id (integer)</text>
<polygon fill="none" stroke="black" points="788.39,-276.5 788.39,-305.25 986.64,-305.25 986.64,-276.5 788.39,-276.5"/>
<text text-anchor="start" x="793.39" y="-283.15" font-family="Sans-Serif" font-size="18.00">created_at (timestamp)</text>
<polygon fill="none" stroke="black" points="788.39,-247.75 788.39,-276.5 986.64,-276.5 986.64,-247.75 788.39,-247.75"/>
<text text-anchor="start" x="793.39" y="-254.4" font-family="Sans-Serif" font-size="18.00">updated_at (timestamp)</text>
</g>
<!-- posts&#45;&gt;users -->
<g id="edge&#45;0" class="edge">
<title>posts:e&#45;&gt;users:w</title>
<path fill="none" stroke="black" d="M987.64,-348.38C1034.14,-348.38 1018.14,-277.96 986.64,-243.75 846.15,-91.13 198.34,-309.72 57.14,-157.75 44.33,-143.96 36.31,-118.41 45.52,-108.6"/>
<polygon fill="black" stroke="black" points="46.59,-111.94 54.72,-105.16 44.13,-105.39 46.59,-111.94"/>
</g>
<!-- posts&#45;&gt;categories -->
<g id="edge&#45;1" class="edge">
<title>posts:e&#45;&gt;categories:w</title>
<path fill="none" stroke="black" d="M987.64,-319.62C1085.41,-319.62 899.95,-108.68 974.48,-91.38"/>
<polygon fill="black" stroke="black" points="974.42,-94.9 984.01,-90.4 973.71,-87.94 974.42,-94.9"/>
</g>
<!-- comments -->
<g id="comments" class="node">
<title>comments</title>
<polygon fill="white" stroke="black" points="390.39,-760.25 180.64,-760.25 180.64,-573.75 390.39,-573.75 390.39,-760.25"/>
<polygon fill="#e8b093" stroke="none" points="188.64,-721.5 188.64,-756.25 382.39,-756.25 382.39,-721.5 188.64,-721.5"/>
<polygon fill="none" stroke="black" points="188.64,-721.5 188.64,-756.25 382.39,-756.25 382.39,-721.5 188.64,-721.5"/>
<text text-anchor="start" x="229.64" y="-728.45" font-family="Sans-Serif" font-size="24.00">comments</text>
<polygon fill="none" stroke="black" points="188.64,-692.75 188.64,-721.5 382.39,-721.5 382.39,-692.75 188.64,-692.75"/>
<text text-anchor="start" x="193.64" y="-699.4" font-family="Sans-Serif" font-size="18.00">id (integer)</text>
<polygon fill="none" stroke="black" points="188.64,-664 188.64,-692.75 382.39,-692.75 382.39,-664 188.64,-664"/>
<text text-anchor="start" x="193.64" y="-670.65" font-family="Sans-Serif" font-size="18.00">post_id (integer)</text>
<polygon fill="none" stroke="black" points="188.64,-635.25 188.64,-664 382.39,-664 382.39,-635.25 188.64,-635.25"/>
<text text-anchor="start" x="193.64" y="-641.9" font-family="Sans-Serif" font-size="18.00">user_id (integer)</text>
<polygon fill="none" stroke="black" points="188.64,-606.5 188.64,-635.25 382.39,-635.25 382.39,-606.5 188.64,-606.5"/>
<text text-anchor="start" x="193.64" y="-613.15" font-family="Sans-Serif" font-size="18.00">content (text)</text>
<polygon fill="none" stroke="black" points="188.64,-577.75 188.64,-606.5 382.39,-606.5 382.39,-577.75 188.64,-577.75"/>
<text text-anchor="start" x="193.64" y="-584.4" font-family="Sans-Serif" font-size="18.00">created_at (timestamp)</text>
</g>
<!-- comments&#45;&gt;users -->
<g id="edge&#45;3" class="edge">
<title>comments:e&#45;&gt;users:w</title>
<path fill="none" stroke="black" d="M383.39,-649.62C661.93,-649.62 -201.36,-119.95 44.84,-104.95"/>
<polygon fill="black" stroke="black" points="44.73,-108.45 54.63,-104.67 44.53,-101.46 44.73,-108.45"/>
</g>
<!-- comments&#45;&gt;posts -->
<g id="edge&#45;2" class="edge">
<title>comments:e&#45;&gt;posts:w</title>
<path fill="none" stroke="black" d="M383.39,-678.38C589.21,-678.38 578.18,-443.59 775.95,-434.87"/>
<polygon fill="black" stroke="black" points="775.96,-438.37 785.88,-434.66 775.8,-431.38 775.96,-438.37"/>
</g>
<!-- tags -->
<g id="tags" class="node">
<title>tags</title>
<polygon fill="white" stroke="black" points="1748.64,-415.88 1570.39,-415.88 1570.39,-315.62 1748.64,-315.62 1748.64,-415.88"/>
<polygon fill="#b8d1a8" stroke="none" points="1578.39,-377.12 1578.39,-411.88 1740.64,-411.88 1740.64,-377.12 1578.39,-377.12"/>
<polygon fill="none" stroke="black" points="1578.39,-377.12 1578.39,-411.88 1740.64,-411.88 1740.64,-377.12 1578.39,-377.12"/>
<text text-anchor="start" x="1636.64" y="-384.07" font-family="Sans-Serif" font-size="24.00">tags</text>
<polygon fill="none" stroke="black" points="1578.39,-348.38 1578.39,-377.12 1740.64,-377.12 1740.64,-348.38 1578.39,-348.38"/>
<text text-anchor="start" x="1583.39" y="-355.02" font-family="Sans-Serif" font-size="18.00">id (integer)</text>
<polygon fill="none" stroke="black" points="1578.39,-319.62 1578.39,-348.38 1740.64,-348.38 1740.64,-319.62 1578.39,-319.62"/>
<text text-anchor="start" x="1583.39" y="-326.27" font-family="Sans-Serif" font-size="18.00">name (varchar(50))</text>
</g>
<!-- post_tags -->
<g id="post_tags" class="node">
<title>post_tags</title>
<polygon fill="white" stroke="black" points="1191.64,-717.12 1037.39,-717.12 1037.39,-616.88 1191.64,-616.88 1191.64,-717.12"/>
<polygon fill="#e8c093" stroke="none" points="1045.39,-678.38 1045.39,-713.12 1183.64,-713.12 1183.64,-678.38 1045.39,-678.38"/>
<polygon fill="none" stroke="black" points="1045.39,-678.38 1045.39,-713.12 1183.64,-713.12 1183.64,-678.38 1045.39,-678.38"/>
<text text-anchor="start" x="1062.02" y="-685.33" font-family="Sans-Serif" font-size="24.00">post_tags</text>
<polygon fill="none" stroke="black" points="1045.39,-649.62 1045.39,-678.38 1183.64,-678.38 1183.64,-649.62 1045.39,-649.62"/>
<text text-anchor="start" x="1050.39" y="-656.27" font-family="Sans-Serif" font-size="18.00">post_id (integer)</text>
<polygon fill="none" stroke="black" points="1045.39,-620.88 1045.39,-649.62 1183.64,-649.62 1183.64,-620.88 1045.39,-620.88"/>
<text text-anchor="start" x="1050.39" y="-627.52" font-family="Sans-Serif" font-size="18.00">tag_id (integer)</text>
</g>
<!-- post_tags&#45;&gt;posts -->
<g id="edge&#45;4" class="edge">
<title>post_tags:e&#45;&gt;posts:w</title>
<path fill="none" stroke="black" d="M1184.64,-664C1205.59,-664 1196.12,-633.7 1183.64,-616.88 1073.56,-468.44 898.3,-636.32 788.39,-487.75 777.31,-472.77 768.39,-448.35 776.72,-438.72"/>
<polygon fill="black" stroke="black" points="777.9,-442.02 785.98,-435.17 775.39,-435.48 777.9,-442.02"/>
</g>
<!-- post_tags&#45;&gt;tags -->
<g id="edge&#45;5" class="edge">
<title>post_tags:e&#45;&gt;tags:w</title>
<path fill="none" stroke="black" d="M1184.64,-635.25C1393.26,-635.25 1366.02,-372.51 1566.11,-363.01"/>
<polygon fill="black" stroke="black" points="1565.96,-366.52 1575.88,-362.79 1565.8,-359.52 1565.96,-366.52"/>
</g>
</g>
<script id="graph-data" type="application/json">{"tables": {"users": {"defaultColor": "#93C4B8", "highlightColor": "#7adcc4", "desaturatedColor": "#a9adac", "edges": ["edge-0", "edge-3"]}, "categories": {"defaultColor": "#E8A8A8", "highlightColor": "#fe9191", "desaturatedColor": "#cbc4c4", "edges": ["edge-1"]}, "posts": {"defaultColor": "#E8D8A8", "highlightColor": "#fee391", "desaturatedColor": "#cbc9c4", "edges": ["edge-0", "edge-1", "edge-2", "edge-4"]}, "comments": {"defaultColor": "#E8B093", "highlightColor": "#ffa87c", "desaturatedColor": "#c1bcb9", "edges": ["edge-2", "edge-3"]}, "tags": {"defaultColor": "#B8D1A8", "highlightColor": "#b3e593", "desaturatedColor": "#bcbeba", "edges": ["edge-5"]}, "post_tags": {"defaultColor": "#E8C093", "highlightColor": "#ffc17c", "desaturatedColor": "#c1bdb9", "edges": ["edge-4", "edge-5"]}}, "edges": {"edge-0": {"tables": ["posts", "users"], "defaultColor": "#E8D8A8", "highlightColor": "#fee391", "desaturatedColor": "#cbc9c4"}, "edge-1": {"tables": ["posts", "categories"], "defaultColor": "#E8D8A8", "highlightColor": "#fee391", "desaturatedColor": "#cbc9c4"}, "edge-2": {"tables": ["comments", "posts"], "defaultColor": "#E8B093", "highlightColor": "#ffa87c", "desaturatedColor": "#c1bcb9"}, "edge-3": {"tables": ["comments", "users"], "defaultColor": "#E8B093", "highlightColor": "#ffa87c", "desaturatedColor": "#c1bcb9"}, "edge-4": {"tables": ["post_tags", "posts"], "defaultColor": "#E8C093", "highlightColor": "#ffc17c", "desaturatedColor": "#c1bdb9"}, "edge-5": {"tables": ["post_tags", "tags"], "defaultColor": "#E8C093", "highlightColor": "#ffc17c", "desaturatedColor": "#c1bdb9"}}, "defaultColor": "#cccccc", "highlightColor": "#ff0000"}</script>

    <defs>
        <style type="text/css">
            #main-svg { overflow: visible; }
            #overlay-container-div {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                pointer-events: none;
                font-family: system-ui, -apple-system, sans-serif;
                z-index: 9999;
            }
            .metadata-box, .miniature-box, .instructions {
                position: absolute;
                z-index: 9999;
                pointer-events: auto;
                box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
                border-radius: 4px;
            }
            .metadata-box {
                top: 10px;
                right: 20px;
                background: lightyellow;
                border: 1px solid #000;
                padding: 10px;
                font-family: monospace;
                font-size: 14px;
                line-height: 1.5;
                max-width: 300px;
            }
            .miniature-box {
                position: absolute;
                top: 10px;
                left: 20px;
                background: white;
                border: 1px solid #ccc;
                padding: 10px;
                z-index: 10000;
                pointer-events: auto;
            }
            .miniature-title {
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 5px;
                text-align: center;
                color: #333;
            }
            .miniature-container {
                position: relative;
                cursor: crosshair;
                border: 1px solid #ccc;
                max-width: 100%;
                max-height: 100%;
                overflow: hidden;
            }
            .miniature-container img {
                max-width: 100%;
                height: auto;
                display: block;
            }
            .viewport-indicator {
                position: absolute;
                border: 2px solid red;
                background-color: rgba(255,0,0,0.2);
                pointer-events: auto;
                opacity: 0.8;
                transition: all 0.1s ease;
                box-sizing: border-box;
                cursor: grab;
            }
            .viewport-indicator.dragging {
                cursor: grabbing;
            }
            .instructions {
                bottom: 10px;
                right: 20px;
                font-size: 11px;
                color: #666;
                background-color: rgba(255,255,255,0.7);
                padding: 3px 6px;
            }
            #main-svg.grabbing {
                cursor: grabbing;
            }
            .node, .edge {
                pointer-events: auto;
                cursor: pointer;
            }
        </style>
    </defs>
    
    <foreignObject id="overlay-container" x="0" y="0" width="100%" height="100%" pointer-events="none">
        <div xmlns="http://www.w3.org/1999/xhtml" id="overlay-container-div" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; font-family: system-ui, -apple-system, sans-serif; z-index: 9999;">
            <div class='metadata-box'><div>Source: Unknown</div><div>File Size: Unknown</div><div>Generated: 2025-07-23 10:42:16</div><div>Tables: 6</div><div>Columns: 23</div><div>Foreign Keys: 6</div><div>Connections: 6</div></div>
        <div class="miniature-box">
            <div class="miniature-title">Overview</div>
            <div class="miniature-container" id="miniature-container">
                <img id="miniature-erd" src="data:image/png;base64,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" width="175" height="100" />
                <div id="viewport-indicator" class="viewport-indicator"></div>
            </div>
        </div>
        
    <div class="instructions">
        ðŸ’¡ Drag to pan â€¢ Scroll to zoom â€¢ Click map to navigate â€¢ Click tables/edges to highlight â€¢ ESC/R to reset
    </div>
    
        </div>
    </foreignObject>
    <script type="text/javascript"><![CDATA[
document.addEventListener('DOMContentLoaded', () => {

    const svg = document.getElementById('main-svg');
    const mainGroup = document.getElementById('main-erd-group');
    const miniatureContainer = document.getElementById('miniature-container');
    const viewportIndicator = document.getElementById('viewport-indicator');
    const overlayContainer = document.getElementById('overlay-container');
    const graphDataElement = document.getElementById('graph-data');

    if (!svg || !mainGroup || !overlayContainer || !graphDataElement) {
        return;
    }

    if (!miniatureContainer || !viewportIndicator) {

    }

    const graphData = JSON.parse(graphDataElement.textContent);
    const { tables, edges } = graphData;

    // --- State variables
    let initialTx = 0, initialTy = 0, initialS = 1; // Transform from Graphviz
    let userTx = 0, userTy = 0, userS = 1; // User-applied transform (pan/zoom)

    let isPanning = false;
    let startX = 0, startY = 0;
    let mouseDownStartX = 0, mouseDownStartY = 0;
    let dragThreshold = 5; // Pixel threshold before panning starts

    let isDraggingIndicator = false;
    let indicatorStartX = 0, indicatorStartY = 0;

    let highlightedElementId = null; // To track the currently highlighted table/edge

    // --- INITIALIZATION ---

    // Parse the initial transform applied by Graphviz to the main group
    const parseTransform = (transform) => {
        const result = { tx: 0, ty: 0, s: 1 };
        if (!transform) return result;
        const translateMatch = transform.match(/translate\(([^,)]+),([^,)]+)\)/);
        if (translateMatch) {
            result.tx = parseFloat(translateMatch[1]);
            result.ty = parseFloat(translateMatch[2]);
        }
        const scaleMatch = transform.match(/scale\(([^)]+)\)/);
        if (scaleMatch) {
            result.s = parseFloat(scaleMatch[1]);
        }
        return result;
    };

    const initialTransform = parseTransform(mainGroup.getAttribute('transform'));
    initialTx = initialTransform.tx;
    initialTy = initialTransform.ty;
    initialS = initialTransform.s;

    // --- CORE FUNCTIONS ---

    // Get the untransformed bounding box of the main diagram content
    const getMainERDBounds = () => {
        return mainGroup.getBBox();
    };

    // Apply the combined (initial + user) transform to the main group
    const applyTransform = () => {
        const finalS = userS * initialS;
        const finalTx = (userTx * initialS) + initialTx;
        const finalTy = (userTy * initialS) + initialTy;
        mainGroup.setAttribute('transform', `translate(${finalTx} ${finalTy}) scale(${finalS})`);
        // Update indicator after transform
        requestAnimationFrame(updateViewportIndicator);
    };

    // Update the red box on the minimap to show the current viewport
    const updateViewportIndicator = () => {
        if (!viewportIndicator) return;

        const mainBounds = getMainERDBounds();
        if (mainBounds.width === 0 || mainBounds.height === 0) return;

        const ctm = mainGroup.getScreenCTM();
        if (!ctm) return;
        const invCtm = ctm.inverse();

        // Find viewport corners in the main group's coordinate system
        const pt1 = svg.createSVGPoint();
        pt1.x = 0;
        pt1.y = 0;
        const svgPt1 = pt1.matrixTransform(invCtm);

        const pt2 = svg.createSVGPoint();
        pt2.x = window.innerWidth;
        pt2.y = window.innerHeight;
        const svgPt2 = pt2.matrixTransform(invCtm);

        const visibleWidth = svgPt2.x - svgPt1.x;
        const visibleHeight = svgPt2.y - svgPt1.y;

        // Calculate relative position and size
        const relLeft = (svgPt1.x - mainBounds.x) / mainBounds.width;
        const relTop = (svgPt1.y - mainBounds.y) / mainBounds.height;
        const relWidth = visibleWidth / mainBounds.width;
        const relHeight = visibleHeight / mainBounds.height;

        // Apply and clamp values
        viewportIndicator.style.left = `${Math.max(0, Math.min(1, relLeft)) * 100}%`;
        viewportIndicator.style.top = `${Math.max(0, Math.min(1, relTop)) * 100}%`;
        viewportIndicator.style.width = `${Math.max(0, Math.min(1, relWidth)) * 100}%`;
        viewportIndicator.style.height = `${Math.max(0, Math.min(1, relHeight)) * 100}%`;
    };

    // Combined handler for any event that changes the viewport
    const onViewportChange = () => {
        requestAnimationFrame(updateViewportIndicator);
    };

    // --- HIGHLIGHTING ---
    const setElementColor = (elem, color, isHighlighted = false) => {
        if (!elem) {
            return;
        }

        if (elem.classList && elem.classList.contains('node')) {
            const mainPath = elem.querySelector('path');
            if (mainPath) {
                mainPath.setAttribute('fill', color);
                if (isHighlighted) {
                    mainPath.setAttribute('stroke-width', '6');
                    mainPath.setAttribute('stroke', color);
                } else {
                    mainPath.setAttribute('stroke-width', '1');
                    mainPath.setAttribute('stroke', 'black');
                }
            }

            const polygons = elem.querySelectorAll('polygon');
            polygons.forEach(polygon => {
                polygon.setAttribute('fill', color);
                if (isHighlighted) {
                    polygon.setAttribute('stroke-width', '6');
                    polygon.setAttribute('stroke', color);
                } else {
                    polygon.setAttribute('stroke-width', '1');
                    polygon.setAttribute('stroke', 'black');
                }
            });
        }

        if (elem.classList && elem.classList.contains('edge')) {
            const edgePath = elem.querySelector('path');
            if (edgePath) {
                edgePath.setAttribute('stroke', color);
                if (isHighlighted) {
                    edgePath.setAttribute('stroke-width', '6');
                } else {
                    edgePath.setAttribute('stroke-width', '3');
                }
            }
        }
    };

    const highlightElements = (tableIds, edgeIds) => {
        tableIds.forEach(id => {
            const tableElement = document.getElementById(id);
            if (tableElement) {
                setElementColor(tableElement, tables[id].highlightColor, true);
            }
        });
        edgeIds.forEach(id => {
            const edgeElement = document.getElementById(id);
            if (edgeElement) {
                setElementColor(edgeElement, edges[id].highlightColor, true);
            }
        });

        Object.keys(tables).forEach(id => {
            if (!tableIds.includes(id)) {
                const tableElement = document.getElementById(id);
                if (tableElement) {
                    setElementColor(tableElement, tables[id].desaturatedColor, false);
                }
            }
        });
        Object.keys(edges).forEach(id => {
            if (!edgeIds.includes(id)) {
                const edgeElement = document.getElementById(id);
                if (edgeElement) {
                    setElementColor(edgeElement, edges[id].desaturatedColor, false);
                }
            }
        });
    };

    const clearAllHighlights = () => {
        Object.keys(tables).forEach(id => {
            const tableElement = document.getElementById(id);
            if (tableElement) {
                setElementColor(tableElement, tables[id].defaultColor, false);
            }
        });
        Object.keys(edges).forEach(id => {
            const edgeElement = document.getElementById(id);
            if (edgeElement) {
                setElementColor(edgeElement, edges[id].defaultColor, false);
            }
        });
        highlightedElementId = null;
    };

    // --- USER ACTIONS ---

    // Reset pan and zoom to the initial state
    const resetZoom = () => {
        userTx = 0;
        userTy = 0;
        userS = 1;
        clearAllHighlights(); // Also clear highlights on reset
        applyTransform();
    };
    const zoomToPoint = (targetX, targetY, zoomLevel = userS) => {
        userS = zoomLevel;
        const finalS = userS * initialS;
        const pt = svg.createSVGPoint();
        pt.x = window.innerWidth / 2;
        pt.y = window.innerHeight / 2;
        const svgCenterPt = pt.matrixTransform(svg.getScreenCTM().inverse());
        const finalTx = svgCenterPt.x - targetX * finalS;
        const finalTy = svgCenterPt.y - targetY * finalS;
        userTx = (finalTx - initialTx) / initialS;
        userTy = (finalTy - initialTy) / initialS;
        applyTransform();
    };


    // --- EVENT LISTENERS ---

    svg.addEventListener('click', (event) => {
        let clickedElement = event.target;
        let tableId = null;
        let edgeId = null;

        while (clickedElement && clickedElement !== svg) {
            if (clickedElement.classList && clickedElement.classList.contains('node')) {
                tableId = clickedElement.id;
                break;
            }

            if (clickedElement.classList && clickedElement.classList.contains('edge')) {
                edgeId = clickedElement.id;
                break;
            }

            clickedElement = clickedElement.parentElement;
        }

        if (tableId && tables[tableId]) {
            event.preventDefault();
            event.stopPropagation();

            if (highlightedElementId === tableId) {
                clearAllHighlights();
            } else {
                clearAllHighlights();
                highlightedElementId = tableId;
                const connectedEdges = tables[tableId].edges;
                const connectedTables = [tableId, ...connectedEdges.map(edgeId => edges[edgeId].tables).flat()];
                const uniqueTables = [...new Set(connectedTables)];
                highlightElements(uniqueTables, connectedEdges);
            }
            return;
        }

        if (edgeId && edges[edgeId]) {
            event.preventDefault();
            event.stopPropagation();

            if (highlightedElementId === edgeId) {
                clearAllHighlights();
            } else {
                clearAllHighlights();
                highlightedElementId = edgeId;
                const connectedTables = edges[edgeId].tables;
                highlightElements(connectedTables, [edgeId]);
            }
            return;
        }
    });

    // Handle dragging the viewport indicator
    if (viewportIndicator) {
        viewportIndicator.addEventListener('mousedown', (event) => {
            event.stopPropagation(); // Prevent main canvas panning
            isDraggingIndicator = true;
            indicatorStartX = event.clientX;
            indicatorStartY = event.clientY;
            viewportIndicator.classList.add('dragging');
        });
    }

    // Handle minimap clicks for zoom-to-point
    if (miniatureContainer) {
        miniatureContainer.addEventListener('click', (event) => {
            // prevent click if dragging the indicator
            if (event.target === viewportIndicator) return;

            const miniRect = miniatureContainer.getBoundingClientRect();
            const clickX = event.clientX - miniRect.left;
            const clickY = event.clientY - miniRect.top;

            const mainBounds = getMainERDBounds();
            const targetX = mainBounds.x + (clickX / miniRect.width) * mainBounds.width;
            const targetY = mainBounds.y + (clickY / miniRect.height) * mainBounds.height;

            zoomToPoint(targetX, targetY);
        });
    }

    svg.addEventListener('mousedown', (event) => {
        if (event.button !== 0 ||
            event.target.closest('.metadata-box, .miniature-box, .instructions') ||
            event.target.id === 'overlay-container' ||
            event.target.closest('.node') ||
            event.target.closest('.edge')) {
            return;
        }
        mouseDownStartX = event.clientX;
        mouseDownStartY = event.clientY;
        startX = event.clientX;
        startY = event.clientY;
        event.preventDefault();
    });

    // Global mouse move for both panning and indicator dragging
    window.addEventListener('mousemove', (event) => {
        // Check if we should start panning (after drag threshold)
        if (!isPanning && mouseDownStartX !== undefined && mouseDownStartY !== undefined) {
            const dx = Math.abs(event.clientX - mouseDownStartX);
            const dy = Math.abs(event.clientY - mouseDownStartY);
            if (dx > dragThreshold || dy > dragThreshold) {
                isPanning = true;
                svg.classList.add('grabbing');
            }
        }

        if (isPanning) {
            event.preventDefault();
            const dx = event.clientX - startX;
            const dy = event.clientY - startY;
            userTx += dx / (userS * initialS);
            userTy += dy / (userS * initialS);
            startX = event.clientX;
            startY = event.clientY;
            applyTransform();
        } else if (isDraggingIndicator) {
            event.preventDefault();
            const dx = event.clientX - indicatorStartX;
            const dy = event.clientY - indicatorStartY;

            const miniRect = miniatureContainer.getBoundingClientRect();
            const mainBounds = getMainERDBounds();

            if (miniRect.width > 0 && miniRect.height > 0) {
                const panX = (dx / miniRect.width) * mainBounds.width;
                const panY = (dy / miniRect.height) * mainBounds.height;

                // Calculate the visible area in main coordinates
                const ctm = mainGroup.getScreenCTM();
                if (!ctm) return;
                const invCtm = ctm.inverse();

                const pt1 = svg.createSVGPoint();
                pt1.x = 0;
                pt1.y = 0;
                const svgPt1 = pt1.matrixTransform(invCtm);

                const pt2 = svg.createSVGPoint();
                pt2.x = window.innerWidth;
                pt2.y = window.innerHeight;
                const svgPt2 = pt2.matrixTransform(invCtm);

                const visibleWidth = svgPt2.x - svgPt1.x;
                const visibleHeight = svgPt2.y - svgPt1.y;

                // Clamp so the viewport indicator stays inside the minimap
                let newUserTx = userTx - panX / initialS;
                let newUserTy = userTy - panY / initialS;

                // Calculate the min/max allowed pan so the viewport stays inside
                const minTx = -(svgPt1.x - mainBounds.x) / initialS;
                const maxTx = (mainBounds.width - visibleWidth - (svgPt1.x - mainBounds.x)) / initialS;
                const minTy = -(svgPt1.y - mainBounds.y) / initialS;
                const maxTy = (mainBounds.height - visibleHeight - (svgPt1.y - mainBounds.y)) / initialS;

                // Clamp the new values
                newUserTx = Math.max(minTx, Math.min(maxTx, newUserTx));
                newUserTy = Math.max(minTy, Math.min(maxTy, newUserTy));

                userTx = newUserTx;
                userTy = newUserTy;

                applyTransform();
            }

            indicatorStartX = event.clientX;
            indicatorStartY = event.clientY;
        }
    });

    const endPan = () => {
        if (isPanning) {
            isPanning = false;
            svg.classList.remove('grabbing');
        }
        if (isDraggingIndicator) {
            isDraggingIndicator = false;
            viewportIndicator.classList.remove('dragging');
        }
        // Reset mouse tracking variables
        mouseDownStartX = undefined;
        mouseDownStartY = undefined;
    };

    window.addEventListener('mouseup', endPan);
    window.addEventListener('mouseleave', endPan);
    const zoomIntensity = 0.1;
    const maxZoomOut = 0.1; // Can zoom out to 20%
    const maxZoomIn = 5;   // Can zoom in to 500%


    // Handle mouse wheel for zooming
    svg.addEventListener('wheel', (event) => {
        event.preventDefault();
        const dir = event.deltaY < 0 ? 1 : -1;
        const scaleAmount = 1 + dir * zoomIntensity;

        let newS = userS * scaleAmount;
        // Clamp the zoom level
        newS = Math.max(maxZoomOut, Math.min(maxZoomIn, newS));

        // Get mouse position in the main group's coordinate system to zoom towards it
        const pt = svg.createSVGPoint();
        pt.x = event.clientX;
        pt.y = event.clientY;
        const svgP = pt.matrixTransform(mainGroup.getScreenCTM().inverse());

        // Update user transform to zoom towards the mouse pointer
        userTx -= (svgP.x * (newS - userS)) / initialS;
        userTy -= (svgP.y * (newS - userS)) / initialS;
        userS = newS;

        applyTransform();
    }, { passive: false });

    // Handle reset keys
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.key.toLowerCase() === 'r') {
            resetZoom();
        }
    });

    // Handle window scroll and resize to keep UI fixed
    window.addEventListener('scroll', onViewportChange, { passive: true });
    window.addEventListener('resize', onViewportChange, { passive: true });


    requestAnimationFrame(() => {
        const mainBounds = getMainERDBounds();
        const centerX = mainBounds.x + mainBounds.width / 2;
        const centerY = mainBounds.y + mainBounds.height / 2;
        zoomToPoint(centerX, centerY, maxZoomOut);
    });
});

]]></script>
</svg>
